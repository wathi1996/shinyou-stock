<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å Shinyou Shabu</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    .nav-btn {
      margin-right: 10px;
    }
    .active-tab {
      background-color: #dc3545;
      color: white;
    }
  </style>
</head>
<body class="p-4">
  <h3 class="text-danger fw-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å <span class="text-dark">Shinyou Shabu</span></h3>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π -->
  <div class="my-3">
    <button class="btn btn-outline-danger nav-btn" onclick="showPage('stock')">üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</button>
    <button class="btn btn-outline-danger nav-btn" onclick="showPage('in')">‚ûï ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
    <button class="btn btn-outline-primary nav-btn" onclick="showPage('out')">‚ûñ ‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
    <button class="btn btn-outline-primary nav-btn" onclick="showPage('adjust')">üìã ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
  </div>

  <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
  <div id="dateSection" class="mb-3 d-none">
    <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
    <input type="date" class="form-control w-auto" id="inputDate">
  </div>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle" id="productTable">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
          <th>Supplier</th>
          <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
          <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
          <th id="qtyHeader">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
        </tr>
      </thead>
      <tbody id="productBody"></tbody>
    </table>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
  <div class="d-none" id="submitSection">
    <button class="btn btn-success" onclick="submitData()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  </div>

  <script>
    let mode = 'stock'; // stock, in, out, adjust
    let productList = [];

    async function loadProducts() {
      const res = await fetch('https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?action=getProducts');
      const products = await res.json();
      productList = products;
      renderTable();
    }

    function showPage(tab) {
      mode = tab;
      document.getElementById("dateSection").classList.toggle("d-none", tab === 'stock');
      document.getElementById("submitSection").classList.toggle("d-none", tab === 'stock');
      document.getElementById("qtyHeader").innerText =
        tab === 'in' ? '‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤' : tab === 'out' ? '‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å' : tab === 'adjust' ? '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà' : '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô';
      renderTable();
    }

    function renderTable() {
      const body = document.getElementById("productBody");
      body.innerHTML = "";
      productList.forEach((p, i) => {
        body.innerHTML += `
          <tr>
            <td>${i + 1}</td>
            <td>${p.name}</td>
            <td>${p.supplier}</td>
            <td>${p.stock}</td>
            <td>${p.unit}</td>
            <td><input type="number" class="form-control" data-name="${p.name}" data-supplier="${p.supplier}" data-unit="${p.unit}" /></td>
          </tr>
        `;
      });
    }

    async function submitData() {
      const inputs = document.querySelectorAll("#productBody input");
      const date = document.getElementById("inputDate").value;
      if (!date) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

      const data = [];
      inputs.forEach(input => {
        const qty = input.value.trim();
        if (qty !== '') {
          data.push({
            date: date,
            name: input.dataset.name,
            supplier: input.dataset.supplier,
            qty: qty,
            unit: input.dataset.unit
          });
        }
      });
      if (data.length === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");

      const actionMap = {
        in: 'submitStockIn',
        out: 'submitStockOut',
        adjust: 'submitAdjustStock'
      };
      const action = actionMap[mode];

      const res = await fetch(`https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?action=${action}`, {
        method: 'POST',
        body: JSON.stringify(data)
      });
      const msg = await res.text();
      alert(msg);
      document.getElementById("inputDate").value = "";
      loadProducts();
    }

    loadProducts();
  </script>
</body>
</html>
